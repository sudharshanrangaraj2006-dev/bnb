<!DOCTYPE html>
<html>
<head>
<title>Opt Calsi</title>

<!-- Excel Export -->
<script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
table {
    border-collapse: collapse;
    border: 2px solid #000;
    width: 100%;
}
td, th {
    text-align:right;
    padding: 10px;
}
td { border-right:2px solid #000; }
th { border:2px solid #000; text-align:center; }
.td { text-align:center; }

.button1 {
    padding:15px;
    background-color:lime;
    border-radius:10px;
    border:2px solid lime;
    font-weight:bold;
    font-size:15px;
}
</style>
</head>

<body>

<h2>Stocks Calculator</h2>

<form onsubmit="calculate(); return false;">
    Capital:
    <input type="number" id="capital" step="0.01" required>

    Margin Cap (0.1 â€“ 0.5):
    <input type="number" id="mg_cap" step="0.01" required>

    Percent:
    <input type="number" id="percent" step="0.01" required>

    Days:
    <input type="number" id="days" required>

    <button class="button1">CALCULATE</button>
    <button class="button1" type="button" onclick="ExportToExcel('xlsx')">EXPORT</button>
</form>

<br>

<div id="result"></div>

<script>
function rnd(a){
    return Math.round(a * 100) / 100;
}

function calculate(){
    let o_capital = Number(document.getElementById("capital").value);
    let mg_cap = Number(document.getElementById("mg_cap").value);
    let percent = Number(document.getElementById("percent").value);
    let days = Number(document.getElementById("days").value);

    let html = `
    <table id="tbl_exporttable_to_xls">
        <tr>
            <th>DAYS</th>
            <th>OPCA</th>
            <th>M1</th>
            <th>RET</th>
            <th>PRO</th>
            <th>MTURN</th>
            <th>GROSS CLOCAP</th>
            <th>CHARGES</th>
            <th>NET CLOCAP</th>
        </tr>`;

    for(let day=1; day<=days; day++){
        let margin = o_capital * mg_cap;
        let profit = margin * (percent / 100);
        let marginturnover = margin + profit;
        let turnover = o_capital + profit;

        let buy = margin;
        let sell = marginturnover;

        let tc = (buy * 0.0006) + (sell * 0.0006);
        let sst = sell * 0.001;
        let stampduty = buy * 0.00003;
        let ipft = (buy * 0.000005) + (sell * 0.000005);
        let sebi = (buy * 0.000001) + (sell * 0.000001);
        let brokerage = 40;
        let gst = (tc + brokerage + sebi + ipft) * 0.18;

        let charges = tc + sst + stampduty + sebi + brokerage + gst + ipft;
        let c_capital = turnover - charges;

        html += `
        <tr>
            <td class="td">Day ${day}</td>
            <td>${rnd(o_capital)}</td>
            <td>${rnd(margin)}</td>
            <td>${rnd(percent)}</td>
            <td>${rnd(profit)}</td>
            <td>${rnd(marginturnover)}</td>
            <td>${rnd(turnover)}</td>
            <td>${rnd(charges)}</td>
            <td>${rnd(c_capital)}</td>
        </tr>`;

        o_capital = c_capital;
    }

    html += "</table>";
    document.getElementById("result").innerHTML = html;
}

function ExportToExcel(type){
    let elt = document.getElementById('tbl_exporttable_to_xls');
    let wb = XLSX.utils.table_to_book(elt, { sheet: "Sheet1" });
    XLSX.writeFile(wb, "Opt_Calsi.xlsx");
}
</script>

</body>
</html>
